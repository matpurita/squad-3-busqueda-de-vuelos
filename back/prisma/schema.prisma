generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Airport {
  id          String   @id @default(cuid())
  code        String   @unique
  name        String
  city        String
  country     String
  flightsTo   Flight[] @relation("FlightsTo")
  flightsFrom Flight[] @relation("FlightsFrom")
}

model Airline {
  id      String   @id @default(cuid())
  code    String   @unique
  name    String
  flights Flight[]
}

model Plane {
  id       String   @id @default(cuid())
  model    String   @unique
  capacity Int
  flights  Flight[]
}

model Flight {
  id            String          @id @default(cuid())
  flightNumber  String
  departure     DateTime
  arrival       DateTime
  airlineId     String?
  originId      String
  destinationId String
  currency      String          @default("USD")
  planeId       String?
  price         Float           @default(dbgenerated("random_price()"))
  status        String          @default("ON_TIME")
  bookings      Booking[]
  BookingIntent BookingIntent[]
  airline       Airline?        @relation(fields: [airlineId], references: [id])
  destination   Airport         @relation("FlightsTo", fields: [destinationId], references: [id])
  origin        Airport         @relation("FlightsFrom", fields: [originId], references: [id])
  plane         Plane?          @relation(fields: [planeId], references: [id])

  @@index([originId])
}

model SearchMetrics {
  id            String    @id @default(cuid())
  userId        String?
  flightsFrom   String
  flightsTo     String
  timestamp     DateTime  @default(now())
  departureDate DateTime
  returnDate    DateTime?
}

model BookingIntent {
  id       String   @id @default(cuid())
  userId   String
  flightId String
  addedAt  DateTime @default(now())
  Flight   Flight   @relation(fields: [flightId], references: [id], map: "FlightBookings_flightId_fkey")
}

model Booking {
  id          String   @id @default(cuid())
  userId      String
  flightId    String
  bookingDate DateTime @default(now())
  status      String   @default("CONFIRMED")
  Flight      Flight   @relation(fields: [flightId], references: [id])
}

model EventLog {
  id        String   @id @default(cuid())
  event     String
  message   String?
  payload   String?
  error     String?
  timestamp DateTime @default(now())
}
