generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Airport {
  id          String   @id @default(cuid())
  code        String   @unique
  name        String
  city        String
  country     String
  flightsTo   Flight[] @relation("FlightsTo")
  flightsFrom Flight[] @relation("FlightsFrom")
}

model Airline {
  id      String   @id @default(cuid())
  code    String   @unique
  name    String
  flights Flight[]
}

model Plane {
  id        String   @id @default(cuid())
  model     String
  capacity  Int
  flights Flight[]
}

model Flight {
  id            String   @id @default(cuid())
  flightNumber  String
  departure     DateTime
  arrival       DateTime
  price         Float    @default(dbgenerated("random_price()"))
  currency      String   @default("USD")
  state         String   @default("ON_TIME")
  planeId       String?
  airlineId     String
  originId      String
  destinationId String
  plane         Plane?   @relation(fields: [planeId], references: [id])
  airline       Airline  @relation(fields: [airlineId], references: [id])
  destination   Airport  @relation("FlightsTo", fields: [destinationId], references: [id])
  origin        Airport  @relation("FlightsFrom", fields: [originId], references: [id])
  bookings      FlightBookings[]

  @@index([originId])
}

model SearchMetrics {
  id          String   @id @default(cuid())
  userId      String?
  flightsFrom String
  flightsTo   String
  dateFrom    DateTime
  dateTo      DateTime
  timestamp   DateTime @default(now())
}

model FlightBookings {
  id        String   @id @default(cuid())
  userId    String
  flightId  String
  timestamp DateTime @default(now())
  flight    Flight   @relation(fields: [flightId], references: [id])
}